version: "3"
services:
    nginx:
        container_name: streamr_nginx_reverse
        image: nginx:1.14-alpine
        restart: on-failure
        ports:
          - "80:80"
        volumes:
          - ./custom-nginx-reverse-proxy.conf:/etc/nginx/nginx.conf:ro
    broker:
        container_name: streamr_dev_broker
        image: streamr/cloud-broker:dev
        restart: on-failure
        depends_on:
            - init_keyspace
        links:
            - cassandra
            - kafka
            - redis
    data-api:
        container_name: streamr_dev_data-api
        image: streamr/data-api:dev
        restart: on-failure
        ports:
            - "8890:8890"
        depends_on:
            - init_keyspace
        links:
            - cassandra
            - kafka
            - redis
            - zookeeper
        environment:
            STREAMR_URL: http://10.200.10.1:8081/streamr-core
    twitter-bitcoin:
          container_name: streamr_dev_twitter-bitcoin
          image: streamr/twitter-bitcoin
          restart: on-failure
          links:
              - data-api
    engine-and-editor:
        container_name: streamr_dev_engine-and-editor
        image: streamr/engine-and-editor:dev
        ports:
            - "8081:8081"
        depends_on:
            - init_keyspace
        links:
            - mysql
            - cassandra
            - kafka
            - redis
            - zookeeper
            - broker
        environment:
            AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
            AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
    ethereum-watcher:
        container_name: streamr_dev_ethereum_watcher
        image: streamr/ethereum-watcher
        restart: on-failure
        depends_on:
            - engine-and-editor
        links:
            - engine-and-editor
        environment:
            STREAMR_API_URL: http://engine-and-editor:8081/streamr-core/api/v1
            METRICS: "false"
        volumes:
            - ./data/ethereum-watcher/:/app/logs
    ganache:
        container_name: streamr_dev_ganache
        image: trufflesuite/ganache-cli
        ports:
          - "8545:8545"
        restart: on-failure
        entrypoint:
          - node
          - /app/ganache-core.docker.cli.js
          - -m
          - arrest sheriff sorry require bench weapon cube artist wish gather tonight glide
    community-product:
        container_name: streamr_dev_cp
        image: streamr/streamr-community-products:dev
        ports:
          - "8085:8085"
        depends_on:
            - ganache
        environment:
            ETHEREUM_SERVER: http://ganache:8545
            ETHEREUM_PRIVATE_KEY: 472e4b208b044caad25f9716b330c3a21f711315eb8c8773e2f6c78a1ae72285
            STREAMR_WS_URL: ws://localhost:8890/api/v1/ws
            STREAMR_HTTP_URL: http://localhost:8081/streamr-core/api/v1

